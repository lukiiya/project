define(function(){!function(a,b){if("object"==typeof exports&&"object"==typeof module)module.exports=b();else if("function"==typeof define&&define.amd)define([],b);else{var c=b();for(var d in c)("object"==typeof exports?exports:a)[d]=c[d]}}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){c(6),c(7),a.exports=c(8)},function(a,b,c){(function(b){!function(c){function d(a,b){return function(){a.apply(b,arguments)}}function e(a){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],k(a,d(g,this),d(h,this))}function f(a){var b=this;return null===this._state?void this._deferreds.push(a):void l(function(){var c=b._state?a.onFulfilled:a.onRejected;if(null===c)return void(b._state?a.resolve:a.reject)(b._value);var d;try{d=c(b._value)}catch(e){return void a.reject(e)}a.resolve(d)})}function g(a){try{if(a===this)throw new TypeError("A promise cannot be resolved with itself.");if(a&&("object"==typeof a||"function"==typeof a)){var b=a.then;if("function"==typeof b)return void k(d(b,a),d(g,this),d(h,this))}this._state=!0,this._value=a,i.call(this)}catch(c){h.call(this,c)}}function h(a){this._state=!1,this._value=a,i.call(this)}function i(){for(var a=0,b=this._deferreds.length;b>a;a++)f.call(this,this._deferreds[a]);this._deferreds=null}function j(a,b,c,d){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.resolve=c,this.reject=d}function k(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(e){if(d)return;d=!0,c(e)}}var l="function"==typeof b&&b||function(a){setTimeout(a,1)},m=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};e.prototype["catch"]=function(a){return this.then(null,a)},e.prototype.then=function(a,b){var c=this;return new e(function(d,e){f.call(c,new j(a,b,d,e))})},e.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&m(arguments[0])?arguments[0]:arguments);return new e(function(b,c){function d(f,g){try{if(g&&("object"==typeof g||"function"==typeof g)){var h=g.then;if("function"==typeof h)return void h.call(g,function(a){d(f,a)},c)}a[f]=g,0===--e&&b(a)}catch(i){c(i)}}if(0===a.length)return b([]);for(var e=a.length,f=0;f<a.length;f++)d(f,a[f])})},e.resolve=function(a){return a&&"object"==typeof a&&a.constructor===e?a:new e(function(b){b(a)})},e.reject=function(a){return new e(function(b,c){c(a)})},e.race=function(a){return new e(function(b,c){for(var d=0,e=a.length;e>d;d++)a[d].then(b,c)})},e._setImmediateFn=function(a){l=a},e.prototype.always=function(a){var b=this.constructor;return this.then(function(c){return b.resolve(a()).then(function(){return c})},function(c){return b.resolve(a()).then(function(){throw c})})},"undefined"!=typeof a&&a.exports?a.exports=e:c.Promise||(c.Promise=e)}(this)}).call(b,c(2).setImmediate)},function(a,b,c){(function(a,d){function e(a,b){this._id=a,this._clearFn=b}var f=c(3).nextTick,g=Function.prototype.apply,h=Array.prototype.slice,i={},j=0;b.setTimeout=function(){return new e(g.call(setTimeout,window,arguments),clearTimeout)},b.setInterval=function(){return new e(g.call(setInterval,window,arguments),clearInterval)},b.clearTimeout=b.clearInterval=function(a){a.close()},e.prototype.unref=e.prototype.ref=function(){},e.prototype.close=function(){this._clearFn.call(window,this._id)},b.enroll=function(a,b){clearTimeout(a._idleTimeoutId),a._idleTimeout=b},b.unenroll=function(a){clearTimeout(a._idleTimeoutId),a._idleTimeout=-1},b._unrefActive=b.active=function(a){clearTimeout(a._idleTimeoutId);var b=a._idleTimeout;b>=0&&(a._idleTimeoutId=setTimeout(function(){a._onTimeout&&a._onTimeout()},b))},b.setImmediate="function"==typeof a?a:function(a){var c=j++,d=arguments.length<2?!1:h.call(arguments,1);return i[c]=!0,f(function(){i[c]&&(d?a.apply(null,d):a.call(null),b.clearImmediate(c))}),c},b.clearImmediate="function"==typeof d?d:function(a){delete i[a]}}).call(b,c(2).setImmediate,c(2).clearImmediate)},function(a,b){function c(){j=!1,g.length?i=g.concat(i):k=-1,i.length&&d()}function d(){if(!j){var a=setTimeout(c);j=!0;for(var b=i.length;b;){for(g=i,i=[];++k<b;)g&&g[k].run();k=-1,b=i.length}g=null,j=!1,clearTimeout(a)}}function e(a,b){this.fun=a,this.array=b}function f(){}var g,h=a.exports={},i=[],j=!1,k=-1;h.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];i.push(new e(a,b)),1!==i.length||j||setTimeout(d,0)},e.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=f,h.addListener=f,h.once=f,h.off=f,h.removeListener=f,h.removeAllListeners=f,h.emit=f,h.binding=function(a){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(a){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(a,b){function c(){var a=~navigator.userAgent.indexOf("Android")&&~navigator.vendor.indexOf("Google")&&!~navigator.userAgent.indexOf("Chrome");return a&&navigator.userAgent.match(/AppleWebKit\/(\d+)/).pop()<=534||/MQQBrowser/g.test(navigator.userAgent)}var d=function(){try{return new Blob,!0}catch(a){return!1}}()?window.Blob:function(a,b){var c=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MSBlobBuilder||window.MozBlobBuilder);return a.forEach(function(a){c.append(a)}),c.getBlob(b?b.type:void 0)},e=function(){var a=0;return function(){var b=this,c=[],e=Array(21).join("-")+(1e16*+new Date*Math.random()).toString(36),f=XMLHttpRequest.prototype.send;this.getParts=function(){return c.toString()},this.append=function(a,b,d){c.push("--"+e+'\r\nContent-Disposition: form-data; name="'+a+'"'),b instanceof Blob?(c.push('; filename="'+(d||"blob")+'"\r\nContent-Type: '+b.type+"\r\n\r\n"),c.push(b)):c.push("\r\n\r\n"+b),c.push("\r\n")},a++,XMLHttpRequest.prototype.send=function(g){var h,i,j=this;g===b?(c.push("--"+e+"--\r\n"),i=new d(c),h=new FileReader,h.onload=function(){f.call(j,h.result)},h.onerror=function(a){throw a},h.readAsArrayBuffer(i),this.setRequestHeader("Content-Type","multipart/form-data; boundary="+e),a--,0==a&&(XMLHttpRequest.prototype.send=f)):f.call(this,g)}}}();a.exports={Blob:d,FormData:c()?e:FormData}},function(a,b,c){var d,e;(function(){function c(a){return!!a.exifdata}function f(a,b){b=b||a.match(/^data\:([^\;]+)\;base64,/im)[1]||"",a=a.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var c=atob(a),d=c.length,e=new ArrayBuffer(d),f=new Uint8Array(e),g=0;d>g;g++)f[g]=c.charCodeAt(g);return e}function g(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="blob",c.onload=function(a){(200==this.status||0===this.status)&&b(this.response)},c.send()}function h(a,b){function c(c){var d=i(c),e=j(c);a.exifdata=d||{},a.iptcdata=e||{},b&&b.call(a)}if(a.src)if(/^data\:/i.test(a.src)){var d=f(a.src);c(d)}else if(/^blob\:/i.test(a.src)){var e=new FileReader;e.onload=function(a){c(a.target.result)},g(a.src,function(a){e.readAsArrayBuffer(a)})}else{var h=new XMLHttpRequest;h.onload=function(){200==this.status||0===this.status?c(h.response):b(new Error("Could not load image")),h=null},h.open("GET",a.src,!0),h.responseType="arraybuffer",h.send(null)}else if(window.FileReader&&(a instanceof window.Blob||a instanceof window.File)){var e=new FileReader;e.onload=function(a){p&&console.log("Got file of length "+a.target.result.byteLength),c(a.target.result)},e.readAsArrayBuffer(a)}}function i(a){var b=new DataView(a);if(p&&console.log("Got file of length "+a.byteLength),255!=b.getUint8(0)||216!=b.getUint8(1))return p&&console.log("Not a valid JPEG"),!1;for(var c,d=2,e=a.byteLength;e>d;){if(255!=b.getUint8(d))return p&&console.log("Not a valid marker at offset "+d+", found: "+b.getUint8(d)),!1;if(c=b.getUint8(d+1),p&&console.log(c),225==c)return p&&console.log("Found 0xFFE1 marker"),o(b,d+4,b.getUint16(d+2)-2);d+=2+b.getUint16(d+2)}}function j(a){var b=new DataView(a);if(p&&console.log("Got file of length "+a.byteLength),255!=b.getUint8(0)||216!=b.getUint8(1))return p&&console.log("Not a valid JPEG"),!1;for(var c=2,d=a.byteLength,e=function(a,b){return 56===a.getUint8(b)&&66===a.getUint8(b+1)&&73===a.getUint8(b+2)&&77===a.getUint8(b+3)&&4===a.getUint8(b+4)&&4===a.getUint8(b+5)};d>c;){if(e(b,c)){var f=b.getUint8(c+7);f%2!==0&&(f+=1),0===f&&(f=4);var g=c+8+f,h=b.getUint16(c+6+f);return k(a,g,h)}c++}}function k(a,b,c){for(var d,e,f,g,h,i=new DataView(a),j={},k=b;b+c>k;)28===i.getUint8(k)&&2===i.getUint8(k+1)&&(g=i.getUint8(k+2),g in v&&(f=i.getInt16(k+3),h=f+5,e=v[g],d=n(i,k+5,f),j.hasOwnProperty(e)?j[e]instanceof Array?j[e].push(d):j[e]=[j[e],d]:j[e]=d)),k++;return j}function l(a,b,c,d,e){var f,g,h,i=a.getUint16(c,!e),j={};for(h=0;i>h;h++)f=c+12*h+2,g=d[a.getUint16(f,!e)],!g&&p&&console.log("Unknown tag: "+a.getUint16(f,!e)),j[g]=m(a,f,b,c,e);return j}function m(a,b,c,d,e){var f,g,h,i,j,k,l=a.getUint16(b+2,!e),m=a.getUint32(b+4,!e),o=a.getUint32(b+8,!e)+c;switch(l){case 1:case 7:if(1==m)return a.getUint8(b+8,!e);for(f=m>4?o:b+8,g=[],i=0;m>i;i++)g[i]=a.getUint8(f+i);return g;case 2:return f=m>4?o:b+8,n(a,f,m-1);case 3:if(1==m)return a.getUint16(b+8,!e);for(f=m>2?o:b+8,g=[],i=0;m>i;i++)g[i]=a.getUint16(f+2*i,!e);return g;case 4:if(1==m)return a.getUint32(b+8,!e);for(g=[],i=0;m>i;i++)g[i]=a.getUint32(o+4*i,!e);return g;case 5:if(1==m)return j=a.getUint32(o,!e),k=a.getUint32(o+4,!e),h=new Number(j/k),h.numerator=j,h.denominator=k,h;for(g=[],i=0;m>i;i++)j=a.getUint32(o+8*i,!e),k=a.getUint32(o+4+8*i,!e),g[i]=new Number(j/k),g[i].numerator=j,g[i].denominator=k;return g;case 9:if(1==m)return a.getInt32(b+8,!e);for(g=[],i=0;m>i;i++)g[i]=a.getInt32(o+4*i,!e);return g;case 10:if(1==m)return a.getInt32(o,!e)/a.getInt32(o+4,!e);for(g=[],i=0;m>i;i++)g[i]=a.getInt32(o+8*i,!e)/a.getInt32(o+4+8*i,!e);return g}}function n(a,b,c){var d,e="";for(d=b;b+c>d;d++)e+=String.fromCharCode(a.getUint8(d));return e}function o(a,b){if("Exif"!=n(a,b,4))return p&&console.log("Not valid EXIF data! "+n(a,b,4)),!1;var c,d,e,f,g,h=b+6;if(18761==a.getUint16(h))c=!1;else{if(19789!=a.getUint16(h))return p&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;c=!0}if(42!=a.getUint16(h+2,!c))return p&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var i=a.getUint32(h+4,!c);if(8>i)return p&&console.log("Not valid TIFF data! (First offset less than 8)",a.getUint32(h+4,!c)),!1;if(d=l(a,h,h+i,s,c),d.ExifIFDPointer){f=l(a,h,h+d.ExifIFDPointer,r,c);for(e in f){switch(e){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":f[e]=u[e][f[e]];break;case"ExifVersion":case"FlashpixVersion":f[e]=String.fromCharCode(f[e][0],f[e][1],f[e][2],f[e][3]);break;case"ComponentsConfiguration":f[e]=u.Components[f[e][0]]+u.Components[f[e][1]]+u.Components[f[e][2]]+u.Components[f[e][3]]}d[e]=f[e]}}if(d.GPSInfoIFDPointer){g=l(a,h,h+d.GPSInfoIFDPointer,t,c);for(e in g){switch(e){case"GPSVersionID":g[e]=g[e][0]+"."+g[e][1]+"."+g[e][2]+"."+g[e][3]}d[e]=g[e]}}return d}var p=!1,q=function(a){return a instanceof q?a:this instanceof q?void(this.EXIFwrapped=a):new q(a)};"undefined"!=typeof a&&a.exports&&(b=a.exports=q),b.EXIF=q;var r=q.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},s=q.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},t=q.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},u=q.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},v={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};q.getData=function(a,b){return(a instanceof Image||a instanceof HTMLImageElement)&&!a.complete?!1:(c(a)?b&&b.call(a):h(a,b),!0)},q.getTag=function(a,b){return c(a)?a.exifdata[b]:void 0},q.getAllTags=function(a){if(!c(a))return{};var b,d=a.exifdata,e={};for(b in d)d.hasOwnProperty(b)&&(e[b]=d[b]);return e},q.pretty=function(a){if(!c(a))return"";var b,d=a.exifdata,e="";for(b in d)d.hasOwnProperty(b)&&(e+="object"==typeof d[b]?d[b]instanceof Number?b+" : "+d[b]+" ["+d[b].numerator+"/"+d[b].denominator+"]\r\n":b+" : ["+d[b].length+" values]\r\n":b+" : "+d[b]+"\r\n");return e},q.readFromBinaryFile=function(a){return i(a)},d=[],e=function(){return q}.apply(b,d),!(void 0!==e&&(a.exports=e))}).call(this)},function(a,b,c){var d,e;!function(){function c(a){var b=a.naturalWidth,c=a.naturalHeight;if(b*c>1048576){var d=document.createElement("canvas");d.width=d.height=1;var e=d.getContext("2d");return e.drawImage(a,-b+1,0),0===e.getImageData(0,0,1,1).data[3]}return!1}function f(a,b,c){var d=document.createElement("canvas");d.width=1,d.height=c;var e=d.getContext("2d");e.drawImage(a,0,0);for(var f=e.getImageData(0,0,1,c).data,g=0,h=c,i=c;i>g;){var j=f[4*(i-1)+3];0===j?h=i:g=i,i=h+g>>1}var k=i/c;return 0===k?1:k}function g(a,b,c){var d=document.createElement("canvas");return h(a,d,b,c),d.toDataURL("image/jpeg",b.quality||.8)}function h(a,b,d,e){var g=a.naturalWidth,h=a.naturalHeight,j=d.width,k=d.height,l=b.getContext("2d");l.save(),i(b,l,j,k,d.orientation);var m=c(a);m&&(g/=2,h/=2);var n=1024,o=document.createElement("canvas");o.width=o.height=n;for(var p=o.getContext("2d"),q=e?f(a,g,h):1,r=Math.ceil(n*j/g),s=Math.ceil(n*k/h/q),t=0,u=0;h>t;){for(var v=0,w=0;g>v;)p.clearRect(0,0,n,n),p.drawImage(a,-v,-t),l.drawImage(o,0,0,n,n,w,u,r,s),v+=n,w+=r;t+=n,u+=s}l.restore(),o=p=null}function i(a,b,c,d,e){switch(e){case 5:case 6:case 7:case 8:a.width=d,a.height=c;break;default:a.width=c,a.height=d}switch(e){case 2:b.translate(c,0),b.scale(-1,1);break;case 3:b.translate(c,d),b.rotate(Math.PI);break;case 4:b.translate(0,d),b.scale(1,-1);break;case 5:b.rotate(.5*Math.PI),b.scale(1,-1);break;case 6:b.rotate(.5*Math.PI),b.translate(0,-d);break;case 7:b.rotate(.5*Math.PI),b.translate(c,-d),b.scale(-1,1);break;case 8:b.rotate(-.5*Math.PI),b.translate(-c,0)}}function j(a){if(window.Blob&&a instanceof Blob){var b=new Image,c=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!c)throw Error("No createObjectURL function found to create blob url");b.src=c.createObjectURL(a),this.blob=a,a=b}if(!a.naturalWidth&&!a.naturalHeight){var d=this;a.onload=function(){var a=d.imageLoadListeners;if(a){d.imageLoadListeners=null;for(var b=0,c=a.length;c>b;b++)a[b]()}},this.imageLoadListeners=[]}this.srcImage=a}j.prototype.render=function(a,b,c){if(this.imageLoadListeners){var d=this;return void this.imageLoadListeners.push(function(){d.render(a,b,c)})}b=b||{};var e=this.srcImage,f=e.src,i=f.length,j=e.naturalWidth,k=e.naturalHeight,l=b.width,m=b.height,n=b.maxWidth,o=b.maxHeight,p=this.blob&&"image/jpeg"===this.blob.type||0===f.indexOf("data:image/jpeg")||f.indexOf(".jpg")===i-4||f.indexOf(".jpeg")===i-5;l&&!m?m=k*l/j<<0:m&&!l?l=j*m/k<<0:(l=j,m=k),n&&l>n&&(l=n,m=k*l/j<<0),o&&m>o&&(m=o,l=j*m/k<<0);var q={width:l,height:m};for(var r in b)q[r]=b[r];var s=a.tagName.toLowerCase();"img"===s?a.src=g(this.srcImage,q,p):"canvas"===s&&h(this.srcImage,a,q,p),"function"==typeof this.onrender&&this.onrender(a),c&&c()},d=[],e=function(){return j}.apply(b,d),!(void 0!==e&&(a.exports=e))}()},function(a,b){function c(a){function b(a){for(var b=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],c=0;64>c;c++){var d=y((b[c]*a+50)/100);1>d?d=1:d>255&&(d=255),z[P[c]]=d}for(var e=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],f=0;64>f;f++){var g=y((e[f]*a+50)/100);1>g?g=1:g>255&&(g=255),A[P[f]]=g}for(var h=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],i=0,j=0;8>j;j++)for(var k=0;8>k;k++)B[i]=1/(z[P[i]]*h[j]*h[k]*8),C[i]=1/(A[P[i]]*h[j]*h[k]*8),i++}function c(a,b){for(var c=0,d=0,e=new Array,f=1;16>=f;f++){for(var g=1;g<=a[f];g++)e[b[d]]=[],e[b[d]][0]=c,e[b[d]][1]=f,d++,c++;c*=2}return e}function d(){t=c(Q,R),u=c(U,V),v=c(S,T),w=c(W,X)}function e(){for(var a=1,b=2,c=1;15>=c;c++){for(var d=a;b>d;d++)E[32767+d]=c,D[32767+d]=[],D[32767+d][1]=c,D[32767+d][0]=d;for(var e=-(b-1);-a>=e;e++)E[32767+e]=c,D[32767+e]=[],D[32767+e][1]=c,D[32767+e][0]=b-1+e;a<<=1,b<<=1}}function f(){for(var a=0;256>a;a++)O[a]=19595*a,O[a+256>>0]=38470*a,O[a+512>>0]=7471*a+32768,O[a+768>>0]=-11059*a,O[a+1024>>0]=-21709*a,O[a+1280>>0]=32768*a+8421375,O[a+1536>>0]=-27439*a,O[a+1792>>0]=-5329*a}function g(a){for(var b=a[0],c=a[1]-1;c>=0;)b&1<<c&&(I|=1<<J),c--,J--,0>J&&(255==I?(h(255),h(0)):h(I),J=7,I=0)}function h(a){H.push(N[a])}function i(a){h(a>>8&255),h(255&a)}function j(a,b){var c,d,e,f,g,h,i,j,k,l=0;const m=8,n=64;for(k=0;m>k;++k){c=a[l],d=a[l+1],e=a[l+2],f=a[l+3],g=a[l+4],h=a[l+5],i=a[l+6],j=a[l+7];var o=c+j,p=c-j,q=d+i,r=d-i,s=e+h,t=e-h,u=f+g,v=f-g,w=o+u,x=o-u,y=q+s,z=q-s;a[l]=w+y,a[l+4]=w-y;var A=.707106781*(z+x);a[l+2]=x+A,a[l+6]=x-A,w=v+t,y=t+r,z=r+p;var B=.382683433*(w-z),C=.5411961*w+B,D=1.306562965*z+B,E=.707106781*y,G=p+E,H=p-E;a[l+5]=H+C,a[l+3]=H-C,a[l+1]=G+D,a[l+7]=G-D,l+=8}for(l=0,k=0;m>k;++k){c=a[l],d=a[l+8],e=a[l+16],f=a[l+24],g=a[l+32],h=a[l+40],i=a[l+48],j=a[l+56];var I=c+j,J=c-j,K=d+i,L=d-i,M=e+h,N=e-h,O=f+g,P=f-g,Q=I+O,R=I-O,S=K+M,T=K-M;a[l]=Q+S,a[l+32]=Q-S;var U=.707106781*(T+R);a[l+16]=R+U,a[l+48]=R-U,Q=P+N,S=N+L,T=L+J;var V=.382683433*(Q-T),W=.5411961*Q+V,X=1.306562965*T+V,Y=.707106781*S,Z=J+Y,$=J-Y;a[l+40]=$+W,a[l+24]=$-W,a[l+8]=Z+X,a[l+56]=Z-X,l++}var _;for(k=0;n>k;++k)_=a[k]*b[k],F[k]=_>0?_+.5|0:_-.5|0;return F}function k(){i(65504),i(16),h(74),h(70),h(73),h(70),h(0),h(1),h(1),h(0),i(1),i(1),h(0),h(0)}function l(a,b){i(65472),i(17),h(8),i(b),i(a),h(3),h(1),h(17),h(0),h(2),h(17),h(1),h(3),h(17),h(1)}function m(){i(65499),i(132),h(0);for(var a=0;64>a;a++)h(z[a]);h(1);for(var b=0;64>b;b++)h(A[b])}function n(){i(65476),i(418),h(0);for(var a=0;16>a;a++)h(Q[a+1]);for(var b=0;11>=b;b++)h(R[b]);h(16);for(var c=0;16>c;c++)h(S[c+1]);for(var d=0;161>=d;d++)h(T[d]);h(1);for(var e=0;16>e;e++)h(U[e+1]);for(var f=0;11>=f;f++)h(V[f]);h(17);for(var g=0;16>g;g++)h(W[g+1]);for(var j=0;161>=j;j++)h(X[j])}function o(){i(65498),i(12),h(3),h(1),h(0),h(2),h(17),h(3),h(17),h(0),h(63),h(0)}function p(a,b,c,d,e){var f,h=e[0],i=e[240];const k=16,l=63,m=64;for(var n=j(a,b),o=0;m>o;++o)G[P[o]]=n[o];var p=G[0]-c;c=G[0],0==p?g(d[0]):(f=32767+p,g(d[E[f]]),g(D[f]));for(var q=63;q>0&&0==G[q];q--);if(0==q)return g(h),c;for(var r,s=1;q>=s;){for(var t=s;0==G[s]&&q>=s;++s);var u=s-t;if(u>=k){r=u>>4;for(var v=1;r>=v;++v)g(i);u=15&u}f=32767+G[s],g(e[(u<<4)+E[f]]),g(D[f]),s++}return q!=l&&g(h),c}function q(){for(var a=String.fromCharCode,b=0;256>b;b++)N[b]=a(b)}function r(a){if(0>=a&&(a=1),a>100&&(a=100),x!=a){var c=0;c=50>a?Math.floor(5e3/a):Math.floor(200-2*a),b(c),x=a}}function s(){var b=(new Date).getTime();a||(a=50),q(),d(),e(),f(),r(a),(new Date).getTime()-b}var t,u,v,w,x,y=(Math.round,Math.floor),z=new Array(64),A=new Array(64),B=new Array(64),C=new Array(64),D=new Array(65535),E=new Array(65535),F=new Array(64),G=new Array(64),H=[],I=0,J=7,K=new Array(64),L=new Array(64),M=new Array(64),N=new Array(256),O=new Array(2048),P=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],Q=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],R=[0,1,2,3,4,5,6,7,8,9,10,11],S=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],T=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],U=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],V=[0,1,2,3,4,5,6,7,8,9,10,11],W=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],X=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];this.encode=function(a,b,c){var d=(new Date).getTime();b&&r(b),H=new Array,I=0,J=7,i(65496),k(),m(),l(a.width,a.height),n(),o();var e=0,f=0,h=0;I=0,J=7,this.encode.displayName="_encode_";for(var j,q,s,x,y,z,A,D,E,F=a.data,G=a.width,N=a.height,P=4*G,Q=0;N>Q;){for(j=0;P>j;){for(y=P*Q+j,z=y,A=-1,D=0,E=0;64>E;E++)D=E>>3,A=4*(7&E),z=y+D*P+A,Q+D>=N&&(z-=P*(Q+1+D-N)),j+A>=P&&(z-=j+A-P+4),q=F[z++],s=F[z++],x=F[z++],K[E]=(O[q]+O[s+256>>0]+O[x+512>>0]>>16)-128,L[E]=(O[q+768>>0]+O[s+1024>>0]+O[x+1280>>0]>>16)-128,M[E]=(O[q+1280>>0]+O[s+1536>>0]+O[x+1792>>0]>>16)-128;e=p(K,B,e,t,v),f=p(L,C,f,u,w),h=p(M,C,h,u,w),j+=32}Q+=8}if(J>=0){var R=[];R[1]=J+1,R[0]=(1<<J+1)-1,g(R)}if(i(65497),c){for(var S=H.length,T=new Uint8Array(S),U=0;S>U;U++)T[U]=H[U].charCodeAt();return H=[],(new Date).getTime()-d,T}var V="data:image/jpeg;base64,"+btoa(H.join(""));return H=[],(new Date).getTime()-d,V},s()}a.exports=c},function(a,b,c){function d(a,b){var c=this;if(!a)throw new Error("没有收到图片，可能的解决方案：https://github.com/think2011/localResizeIMG/issues/7");b=b||{},c.defaults={width:null,height:null,fieldName:"file",quality:.7},c.file=a;for(var d in b)b.hasOwnProperty(d)&&(c.defaults[d]=b[d]);return this.init()}function e(a){var b=null;return b=a?[].filter.call(document.scripts,function(b){return-1!==b.src.indexOf(a)})[0]:document.scripts[document.scripts.length-1],b?b.src.substr(0,b.src.lastIndexOf("/")):null}function f(a){var b;b=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):unescape(a.split(",")[1]);for(var c=a.split(",")[0].split(":")[1].split(";")[0],d=new Uint8Array(b.length),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new h.Blob([d.buffer],{type:c})}c.p=e("lrz")+"/",window.URL=window.URL||window.webkitURL;var g=c(1),h=c(4),i=c(5),j=function(a){var b=/OS (\d)_.* like Mac OS X/g.exec(a),c=/Android (\d.*?);/g.exec(a)||/Android\/(\d.*?) /g.exec(a);return{oldIOS:b?+b.pop()<8:!1,oldAndroid:c?+c.pop().substr(0,3)<4.5:!1,iOS:/\(i[^;]+;( U;)? CPU.+Mac OS X/.test(a),android:/Android/g.test(a),mQQBrowser:/MQQBrowser/g.test(a)}}(navigator.userAgent);d.prototype.init=function(){var a=this,b=a.file,c="string"==typeof b,d=/^data:/.test(b),e=new Image,i=document.createElement("canvas"),j=c?b:URL.createObjectURL(b);if(a.img=e,a.blob=j,a.canvas=i,c?a.fileName=d?"base64.jpg":b.split("/").pop():a.fileName=b.name,!document.createElement("canvas").getContext)throw new Error("浏览器不支持canvas");return new g(function(c,g){e.onerror=function(){throw new Error("加载图片文件失败")},e.onload=function(){a._getBase64().then(function(a){return a.length<10&&g("生成base64失败"),a}).then(function(d){var e=null;"object"==typeof a.file&&d.length>a.file.size?(e=new FormData,b=a.file):(e=new h.FormData,b=f(d)),e.append(a.defaults.fieldName,b,a.fileName.replace(/\..+/g,".jpg")),c({formData:e,fileLen:+b.size,base64:d,base64Len:d.length,origin:a.file,file:b});for(var g in a)a.hasOwnProperty(g)&&(a[g]=null);URL.revokeObjectURL(a.blob)})},!d&&(e.crossOrigin="*"),e.src=j})},d.prototype._getBase64=function(){var a=this,b=a.img,c=a.file,d=a.canvas;return new g(function(e){try{i.getData("object"==typeof c?c:b,function(){a.orientation=i.getTag(this,"Orientation"),a.resize=a._getResize(),a.ctx=d.getContext("2d"),d.width=a.resize.width,d.height=a.resize.height,a.ctx.fillStyle="#fff",a.ctx.fillRect(0,0,d.width,d.height),j.oldIOS?a._createBase64ForOldIOS().then(e):a._createBase64().then(e)})}catch(f){throw new Error(f)}})},d.prototype._createBase64ForOldIOS=function(){var a=this,b=a.img,d=a.canvas,e=a.defaults,f=a.orientation;return new g(function(a){!function(){var g=[c(6)];(function(c){var g=new c(b);"5678".indexOf(f)>-1?g.render(d,{width:d.height,height:d.width,orientation:f}):g.render(d,{width:d.width,height:d.height,orientation:f}),a(d.toDataURL("image/jpeg",e.quality))}).apply(null,g)}()})},d.prototype._createBase64=function(){var a=this,b=a.resize,d=a.img,e=a.canvas,f=a.ctx,h=a.defaults,i=a.orientation;switch(i){case 3:f.rotate(180*Math.PI/180),f.drawImage(d,-b.width,-b.height,b.width,b.height);break;case 6:f.rotate(90*Math.PI/180),f.drawImage(d,0,-b.width,b.height,b.width);break;case 8:f.rotate(270*Math.PI/180),f.drawImage(d,-b.height,0,b.height,b.width);break;case 2:f.translate(b.width,0),f.scale(-1,1),f.drawImage(d,0,0,b.width,b.height);break;case 4:f.translate(b.width,0),f.scale(-1,1),f.rotate(180*Math.PI/180),f.drawImage(d,-b.width,-b.height,b.width,b.height);break;case 5:f.translate(b.width,0),f.scale(-1,1),f.rotate(90*Math.PI/180),f.drawImage(d,0,-b.width,b.height,b.width);break;case 7:f.translate(b.width,0),f.scale(-1,1),f.rotate(270*Math.PI/180),f.drawImage(d,-b.height,0,b.height,b.width);break;default:f.drawImage(d,0,0,b.width,b.height)}return new g(function(a){j.oldAndroid||j.mQQBrowser||!navigator.userAgent?!function(){var b=[c(7)];(function(b){var c=new b,d=f.getImageData(0,0,e.width,e.height);a(c.encode(d,100*h.quality))}).apply(null,b)}():a(e.toDataURL("image/jpeg",h.quality))})},d.prototype._getResize=function(){var a=this,b=a.img,c=a.defaults,d=c.width,e=c.height,f=a.orientation,g={width:b.width,height:b.height};if("5678".indexOf(f)>-1&&(g.width=b.height,g.height=b.width),g.width<d||g.height<e)return g;var h=g.width/g.height;for(d&&e?h>=d/e?g.width>d&&(g.width=d,g.height=Math.ceil(d/h)):g.height>e&&(g.height=e,g.width=Math.ceil(e*h)):d?d<g.width&&(g.width=d,g.height=Math.ceil(d/h)):e&&e<g.height&&(g.width=Math.ceil(e*h),g.height=e);g.width>=3264||g.height>=2448;)g.width*=.8,g.height*=.8;return g},window.lrz=function(a,b){return new d(a,b)},window.lrz.version="4.9.36",a.exports=window.lrz}])})});